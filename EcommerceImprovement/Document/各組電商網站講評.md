聲明:
1.以下是老師用幾個工作天,概略檢查各組電商網站的功能及語法, 若有誤解或不週詳之處請見諒
2.給各組評論係以MVC基本功能運用之正確性為出發點
3.請各位同學著重在[改進]方面之建議, 目的是可以讓同學有機會修正自己程式, 讓自己觀念與技巧再提升一個層次
4.同時也不要覺得是別人在挑剔你的缺點, 而讓自己失去了能力與技巧可以升級的機會
5.以下編號順序並非是各組編號, 同時命令是以電商產品或服務的通用名稱之命名

一.書店
https://mvcprojecttest20190614051921.azurewebsites.net/

優點:
1. Message Us不錯
2. 會員註冊欄位資料驗證,在Model做得不錯,看得出來很努力(Model Validation)
3. 使用Mix ViewModel來傳遞複雜的資料

改進:
1.請導入路由(四種書的路由)
2.會員註冊後,直接跳回主網頁,讓人摸不著頭緒
3. 註冊後有用SendGrid發送電子郵件,這很好.但訊息用字和語意沒有很完整
4. Email驗證後, 乎也沒有什麼成功導引畫面
5. 書本加入購物車後, 是否給個提示訊息, 或者購物車數量要Update一下
6. 購物車數量太多時, 最下拉式選單過長,最下面的訊息無法點選(除非用全螢幕)


程式改進面:
1. Repository類別沒有消除每個都需要取得連線字串,以及New SqlConnection的工作(請用繼承和單件)
2. 有用到MixModel很不錯, 表示上課有認真聽, 並且應用到實務專案中
3. Models/RealAuthor.cs目前有允許一位作者, 但實際上有可能有多位作者
4. BackStage/CustomerEdit會呼叫CustomerUpdate(),但該方法沒有套用[HttpPost], 且完成後轉向至return RedirectToAction("CustomerIndex", "BackStage");有點奇怪,應該提在本頁,同時給個成功提示訊
5. 所有的Post Action都缺乏[ValidateAntiForgeryToken]
6. Mix.cs應該放在ViewModel
7. 為何要自訂JsonNetController ? 似乎只是要用JSON.net而已, 有特殊功用?
8. BookController.cs中Action內的程式碼應可以抽出成為獨立Service
9. CustomersRepository.cs中好幾個地方使用了加字串, 正確應使用Dapper參數(太危險)
參考 https://dapper-tutorial.net/parameter-anonymous

二.珠寶網
https://anvimvc.azurewebsites.net/

優點:
1. 整個網站的設計, 使用很經典程式手法, 有充份使用到老師相關技術
2. 使用Code First Migrations建立產品種子資料, 非常好
3. Sidebar用類別建立的方式很好
4. 充份使用Enum
5. 使用jQuery DataTable來呈現資料和資料筆數


改進:
1.註冊及產品購買成功, 皆發送Email
2. AnviModel.cs改名為AnviContext.cs語意及用途分類會更好,更明確
3.後台報表, 點選[產品]分類下的子項目, 報表顯示後, 子項目Sidebar又會自動收合(應該不要讓它收合)
4. BackSystemController類別中,應將以下兩行抽出放至預設建構子, 或者是全域的Helper.
	int Days = DateTime.Today.Day;
	int Month = DateTime.Today.Month;
5.BackSystemController類別,LINQ查詢中where o.OrderDate.Month == DateTime.Now.Month, 應直接使用Month變數
6.BackSystemController/AllStockChart()的庫存邏輯最好移至View,使用Razor語法, 同時配合@Helpers或@Functions
AllStockChart()需要改進的地方:
(1)顯示邏輯將Controller/Action複雜化了,同也違反了SoC
(2)顯示邏輯最好移至View
(3)庫存計算方式可以用LINQ等手法讓程式質感再提升一個層次(請看EcommerceImprovement專案的AnviController/AllStockChart ), 相同手法可套用到所有其他Actions
(4) AllStockChartClean則是使用@Helpers抽離Chart繪圖元件, 讓View更形簡單乾淨, 將複雜的邏輯隱藏在@Helper中
7.BackSystem的所有Views套用Layout = "~/Views/Shared/_BackSystem_Layout.cshtml", 可以在該資料夾新增一個_ViewStart.cshtml來指定共用的佈局檔(其他亦然)
8.路由幾乎是白設了,因為新增的路由設定, 和原本預設路由是一樣的
9. 不要用點點, 改波浪 return View("../BackSystem/ListAllProduct", products);
10.問一下,為什麼你們專案是使用Bootstrap 3.4.1而不是4.x版?
11.所有處理表單提交的Post Actions, 都沒有套用[ValidationAntiForgeryToken]



三.賣酒
https://team7mvc20190606035227.azurewebsites.net/

優點:
1.首頁設計風格還不錯
2.正確使用Repository & Dapper

改進:
1.Search Textbox與Search Button高度不一致
2.一般購物網站除了[Buy Now],還會有[Add to Cart]
3.查詢酒類的Checkbox, 在查詢後是否應該保持勾選狀態?
4.註冊帳號時, 生日請用日曆控制項
5.註冊帳號和Email兩欄之間有什麼區別?
6.註冊會失敗
7.註冊頁密碼應該雙重欄位
8.註冊欄立若不符合規定, 沒有明顯錯誤提示
9.在首頁Menu, 選酒就要直接加入[酒類]和[產地]
  https://wineonsale.com/
10.訂閱電子報機制, 是否有取消機制?使用者如何取消
11.酒類查詢,如果進入Mobile行動裝置模式, 會跑版,錯亂
12.酒的分類可以導入路由

程式改進:
1. AdminController/ProductCreate()和ProductEdit()參數請直用Product ( WineController.cs亦同)
2.AdminController/ProductCreate()和ProductEdit()方法請套[ValidateAntiforegyToken]
3.Models/Customer.cs和ViewModels等數個模型請套用較為嚴謹的Model Validation模型驗證
4.可以定義一個BaseRepository.cs讓所有Repository繼承, 消滅掉預設建構式中的字串連線物件初始化
5. WineRepository.cs中, 酒類建議可以使用Enum來做分類, 同時在View顯示可用DropDwonList下接式選單替代, 同時顯示中文名
6. WineController.cs的ProductPage(int? id)改成if(Id==null) else {} , 甚或者直接用[products = Id == null ? _repo.Getproducts(Id) : _repo.GetProducts();]更有威力
7.WineController.cs的Contact()的ViewData傳資料和下面的Message模型複的, 應該是不需要
8.同時Contact.cshtml的Category有可能會結合資料庫, 故應在Action裡面做好SelectLst,後傳給View(採用Html Helpers)
9.WineController.cs的ProductPage.cshtml產地和類型的項目應在Action建好項目資料, 然後傳給View, 並結合for迴圈及Html Helpers
10.Product/Index.cshtml亦同上
11. CustomerController.cs的CustomerEdit()接收的參數應改成Customer模型(請套[ValidateAntiforegyToken])
12. 可以為每個控制器View資料夾建立專屬_Layout佈局檔+_ViewStart.cshtml, 來改善重複載入@section JQuery區段
    以Views/Product資料夾為例, 可以將@section JQuery區段定義移到專屬的_Layout佈局檔中, 個別View就不需要再定義了


四. Gugu電競商品
https://gurutwmvc.azurewebsites.net/


優點:
1.產品Carousel做得不錯
2.前端產品排序不錯(category_js.js做排序)
3. 路由使用很正確, 非常好
4. Dashboard後台的佈景顏色可以調設定(齒輪)
5. OrderM/Index有使用IPagedList分頁控制項

改進:
1.RWD, 4欄直進2欄, 應該插個3欄
2.搜尋功能沒做
3.使用者登入後, Menu選單會跑版
4.使用者資訊Update表單,應再補Caption
5.產品明細縮圖, 應改成Mouse Hover時就跟著換大圖
6.產品明細放大鏡右側超過圖片邊界, 左側邊界右移太多
6.後台訂單管理, [Generate Report]產生報表功能還沒更新
7.後台[Member Management]->[Customer Management]
8. Memebr/Index會員資料可以加入分頁及TextBox Search

程式改進:
1.HomeRepository.cs中Dapper的SQL字串, 請不要用加字串. 其他Repository亦同
2.HomeController.cs的Registration()中的寄信程式,可以抽出來, 獨立寫成一個SendMail的services(MemberController/CreateOrderDetail()亦然)
3.HomeController.cs的SignIn(),  Logout()Registration()和VerifyRegisCode()可以移至AccountController
4.HomeController.cs的Search()中Dapper SQL避免使用加字串
5.HomeController.cs的Search()的Dapper查詢請抽出來成為獨立的Repository
6.HomeRepository可改名為ProductRepository
7.如果使用了Repository, HomeController.cs不應再用using(conn), 或直接做Dapper的SQL查詢
8. DashboardController/Dashboard.cshtml, 請將Action用ViewBag傳遞過來的集合, 在View中還原轉型成強型別集合,
    然後所有用迴圈計算的部分, 改用LINQ計算與簡化掉.
9.OrderMController/Index()塞給ViewBag的資料, 請改用ViewModel, 然後以model方式傳遞給View
10.OrderMController/Ship()的發信可以抽出獨立成一個SendMail類別服務.
11.ProductMController/ProductFeature.cshtml的<style>區段,請用@section帶入_Layout, 不要直接寫死在View中
12.所有Controller的Post Action請套用[ValidateAnitForgeryToken]
13.Bbt1專案使用Model Fisrt的.edmx, 但這種模式算是早被拋棄的模式, 請改用Code First來設計

五. 導遊伴遊 (無法註冊,所以無法看)
https://friendtour.azurewebsites.net/

優點:
1.Home/Index高度使用PartialView來簡化View主頁面的設計
2.整個專案註解做得很周詳, 很乾淨

改進:
1.註冊不成功,要有錯誤提示
2.登入不成功,要有錯誤提示
3.可以象徵性導入路由, 例如北部, 中部, 南部, 東部或各縣市
4.可以加上Dashboard後台統計功能


程式改進:
1.所有Repository請直接使用using(conn),不要再new SqlConnection()了
2.所有在Repository中的Model或ViewModel, 請移至Model或ViewModel資料夾
3. Tour/TourDetailByGuide.cshtml 中不要初始化ORM或Repository, 違反SoC關注點分離,這不合規
5. TourController/TourDetailByGuide()中, getTourByDetail應該使用model傳遞就夠了, 不要同時使用ViewData傳遞傳遞相同的東西, 在TourDetailByGuide.cshtml.cshtml亦然
6. 所有Controller的Post Action請套用[ValidateAntiForgeryToken]
7. TourController/TourDetailByGuide.cshtml 中不要做直接呼叫Repository的呼叫, 應在Action先判斷好狀態,然後傳狀態給View就好了( 是因為不知如何一次傳遞多個model緣故?)
8. 可以考慮導入ViewModel, 例如Tour/TourDetailByGuide.cshtml中呼叫InsertTourOrder(), 傳入參數就可以使用model物件, 同時享用ViewModel原先制定的Model Validation驗證規則
9. Model Validation設定限制條件的同時, 請加上自訂Error的錯誤訊息提示.


六. 募資網
https://catchu.azurewebsites.net/

優點:
1.大量使用Ajax非同步技術
2.Project/EditProject更新資料使用Ajax Form
3.Project/UpdateProject()當成Web API使用, 吐JSON資料給前端
4.大量使用Partial View來簡化設計

改進:
1.導入路由
2.Home/Category?category=休閒路由不夠優化, 可以直接優化成Home/Category/休閒
3.Project/project/18路由不夠優化,可以直接優化成Project/18
4.註冊失敗時, 會提示錯誤訊息, 但也把輸入的資料清除,這是不對的
5.註冊時, 年份可輸入達5位數,這是不太OK的
6.贊助時的Email信箱, 能否從會員註冊資料自動帶入
7.贊助人相關資料, 能否保存至會員資料中, 這樣每次贊助就不必用手Key
8.[關於我們]還沒設計

程式改進:
1. HomeController的DbContext的初始化, 請集中在類別的預設建構子中統一建立, 不要在每個Action中初始化(其他控制器亦然)
2. 同時採用上述方式後, 也不需用using(DbConext)來包住, 只需在類別末端統一加上EF的Dispose()方法
    protected override void Dispose(bool disposing)
    {
        db.Dispose();
        base.Dispose(disposing);
    }
3. 所有Controller的Post Action請套用[ValidationAntiForgeryToken]
4. HomeController/search()中Repository初始化,也請集中在類別的預設建構子中統一建立, 不要在每個Action中初始化(其他控制器亦然)
5. Models/ViewModel/EditProject中, Model Vlidation請加上自訂Error的錯誤訊息提示.
6. ProjectController/EditProject中使用了四個Repository, 其實可以考慮使用ViewModel定義4-5個model或集合成員, 然後呼叫一個Repository, 回傳一個ViewModel, 取得所有資料
7. Action呼叫Repository, 但是Action中加上大量的資料判斷邏輯, 將來是否考慮將複雜資料邏輯移至Repository就好, 以簡化Action程式的複雜度
8. UploadRepository的UploadfileToUrl()皆為靜態方法, 但是在多人檔案上傳中有可能同時使用, 資源或變數是否有可能會錯亂? 建議要用lock去鎖定
   可參考https://docs.microsoft.com/zh-tw/dotnet/csharp/language-reference/keywords/lock-statement
9. UserController/userEdit()中,像以下集合資料物件, 可以考慮移至Helpers中的類別
List<SelectListItem> items = new List<SelectListItem>()
{
    new SelectListItem() {Text = "男", Value = "1", Selected = false},
    new SelectListItem() {Text = "女", Value = "2", Selected = false},
    new SelectListItem() {Text = "其他", Value = "3", Selected = false}
};

10.UserController/userDetails()要先判斷id是否等於null,再決定是否要查詢資料庫, 以避免浪費不必要的效能
11.ProjectController和UserController中, 是初始化一個DbContext再傳給Repository, 但是否比較好的作法是直接在Repository內建立DbContext物件
12. Model Validation設定限制條件的同時, 請加上自訂Error的錯誤訊息提示.
13.題外話:想請問本組Model類別檔的產生, 是否用Code First從資料庫產出模型類別檔?
14. Services資料夾中四個類別程式, 無論是傳入的DbContext或自己初始化DbContext, 建議直接在Repository內建立DbContext物件


七. 賣衣服
https://shopmvc.azurewebsites.net/

優點:
1.產品明細的價格Ranger功能不錯
2.大量使用Web API

改進:
1.導入路由
2.註冊帳號成功後, 應該就直接登入,
3.註冊成功後,沒有發送信件給會員
4.產品應該加入[加入購物車], 不能單只有[購買]按鈕

程式改進:
1.https://.../api/dashboardIndex/GetMaster安全性漏洞太大,等於資料大門洞開(其他API亦然)
  參考:https://docs.microsoft.com/zh-tw/aspnet/web-api/overview/security/individual-accounts-in-web-api
2.所有Controller的Post Action請套用[ValidationAntiForgeryToken]
3.Service/ProductService.cs中, DbContext初始化應放到類別的預設建構子中(其他類別亦然)
4.將來是否考慮將複雜資料邏輯和DbContext移至Repository就好, 以簡化叫用端的邏輯(設計的方式與募資網十分神似,二組是否有程式交流?)
5.題外話:想請問本組Model類別檔的產生, 是否用Code First從資料庫產出模型類別檔?
6.如果Repository使用EF的DbContext, 應使用using()包住DbContext,來釋放掉DbContext佔用資源, 要不使用解建構式
C#解建構式 : https://docs.microsoft.com/zh-tw/dotnet/csharp/programming-guide/classes-and-structs/destructors
Huanlin學習筆記-Entity Framework DbContext 物件的生命週期 https://www.huanlintalk.com/2012/12/entity-framework-dbcontext-lifetime-in.html
7.dashboardCategoryController/Index()中共用的類別請放在預設建構子中初始化








